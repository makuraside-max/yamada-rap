<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üé§ RAP BOARD</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@700;900&family=Bebas+Neue&display=swap" rel="stylesheet" />
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      min-height: 100vh;
      background: #0a0a0f;
      font-family: 'Noto Sans JP', sans-serif;
      color: #fff;
      padding-bottom: 48px;
      overflow-x: hidden;
    }

    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background-image:
        linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px);
      background-size: 40px 40px;
      pointer-events: none;
      z-index: 0;
    }

    #header {
      position: relative;
      z-index: 1;
      text-align: center;
      padding: 28px 16px 12px;
    }
    #logo {
      display: block;
      font-family: 'Bebas Neue', cursive;
      font-size: clamp(2rem, 8vw, 3.5rem);
      letter-spacing: 0.12em;
      background: linear-gradient(90deg, #FF3366, #FF9900, #00E5FF);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    #sub {
      display: block;
      font-size: 0.75rem;
      color: #666;
      letter-spacing: 0.2em;
      margin-top: 4px;
    }

    #beat-row {
      position: relative;
      z-index: 1;
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
      padding: 0 12px 20px;
    }
    .beat-btn {
      font-family: 'Bebas Neue', cursive;
      font-size: clamp(1rem, 4vw, 1.1rem);
      letter-spacing: 0.1em;
      padding: clamp(12px, 3vw, 14px) clamp(24px, 6vw, 40px);
      border-radius: 6px;
      cursor: pointer;
      border: 2px solid rgba(255,255,255,0.15);
      background: rgba(255,255,255,0.05);
      color: #aaa;
      transition: all 0.2s ease;
      min-height: 48px;
      touch-action: manipulation;
    }
    .beat-btn.active {
      background: linear-gradient(135deg, #FF3366, #FF9900);
      border-color: #FF9900;
      color: #fff;
      box-shadow: 0 0 24px #FF990088;
    }

    #display-area {
      position: relative;
      z-index: 1;
      margin: 0 12px 20px;
      min-height: 130px;
      border: 1.5px solid #333;
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 12px;
      padding: 20px 12px;
      background: rgba(255,255,255,0.02);
      transition: border-color 0.3s;
    }
    #big-word {
      font-family: 'Bebas Neue', cursive;
      font-size: clamp(2.5rem, 18vw, 6rem);
      letter-spacing: 0.05em;
      line-height: 1;
      text-shadow: 0 0 40px currentColor;
      display: none;
      text-align: center;
      word-break: break-all;
    }
    #big-word.pop {
      display: block;
      animation: popIn 0.35s cubic-bezier(.36,2,.6,1) forwards;
    }
    #placeholder {
      color: #333;
      font-size: clamp(0.75rem, 3vw, 0.9rem);
      letter-spacing: 0.1em;
      text-align: center;
    }

    #lyric-tape {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      justify-content: center;
      max-width: 100%;
    }
    .lyric-chip {
      font-size: clamp(0.7rem, 2.5vw, 0.8rem);
      border: 1px solid;
      border-radius: 3px;
      padding: 3px 8px;
      font-weight: 700;
      letter-spacing: 0.05em;
    }
    #clear-btn {
      font-size: 0.75rem;
      background: transparent;
      border: 1px solid #333;
      color: #555;
      border-radius: 4px;
      padding: 8px 16px;
      cursor: pointer;
      letter-spacing: 0.1em;
      display: none;
      min-height: 44px;
      touch-action: manipulation;
    }
    #clear-btn:hover { border-color: #666; color: #999; }

    #groups-area {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      gap: 12px;
      padding: 0 12px;
      max-width: 900px;
      margin: 0 auto;
    }
    .group {
      background: rgba(255,255,255,0.02);
      border: 1px solid rgba(255,255,255,0.06);
      border-radius: 8px;
      padding: 12px;
    }
    .group-label {
      font-family: 'Bebas Neue', cursive;
      font-size: clamp(0.8rem, 3vw, 0.9rem);
      letter-spacing: 0.2em;
      padding-left: 8px;
      margin-bottom: 10px;
    }
    .word-grid {
      display: flex;
      flex-wrap: wrap;
      gap: clamp(6px, 2vw, 8px);
    }
    .word-btn {
      font-family: 'Noto Sans JP', sans-serif;
      font-weight: 700;
      font-size: clamp(0.85rem, 3.5vw, 0.95rem);
      padding: clamp(10px, 2.5vw, 10px) clamp(12px, 3vw, 16px);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.15s ease;
      letter-spacing: 0.03em;
      white-space: nowrap;
      min-height: 44px;
      touch-action: manipulation;
    }
    .word-btn:hover  { transform: scale(1.06); }
    .word-btn:active { transform: scale(0.95); }

    /* „Çπ„Éû„ÉõÁî®ËøΩÂä†Ë™øÊï¥ */
    @media (max-width: 480px) {
      #header { padding: 20px 12px 10px; }
      #beat-row { gap: 8px; padding-bottom: 16px; }
      .beat-btn { padding: 12px 20px; width: calc(50% - 4px); text-align: center; }
      #display-area { margin: 0 10px 16px; min-height: 110px; }
      #groups-area { gap: 10px; padding: 0 10px; }
      .group { padding: 10px; }
    }

    @keyframes popIn {
      0%   { transform: scale(0.5) rotate(-5deg); opacity: 0; }
      60%  { transform: scale(1.15) rotate(2deg); opacity: 1; }
      100% { transform: scale(1) rotate(0deg);   opacity: 1; }
    }

    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
  </style>
</head>
<body>

  <div id="header">
    <span id="logo">üé§ RAP BOARD</span>
    <span id="sub">„Éì„Éº„Éà„ÇíÈÅ∏„Çì„Åß„ÄÅÂçòË™û„ÇíÂè©„Åë</span>
  </div>

  <div id="beat-row"></div>

  <div id="display-area">
    <div id="placeholder">‚Üì ÂçòË™û„ÇíÊäº„Åó„Å¶„É©„ÉÉ„Éó„Åó„Çç ‚Üì</div>
    <div id="big-word"></div>
    <div id="lyric-tape"></div>
    <button id="clear-btn" onclick="clearLyric()">„ÇØ„É™„Ç¢</button>
  </div>

  <div id="groups-area"></div>

  <script>

    /* ============================================
       „Éá„Éº„ÇøÂÆöÁæ©
    ============================================ */

    var beats = ["üî• TRAP", "üí• BOOM BAP"];

    var groups = [
      { label: "G1 ‰∏ªË™û", color: "#FF3366",
        words: ["‰ø∫„ÅØ", "‰ø∫„ÅÆ", "„Åì„ÅÑ„Å§„ÅØ", "‰ø∫„Çâ„ÅØ", "„Åä„Åæ„Åà", "ÂÖàÁîü", "ÊØç„Å°„ÇÉ„Çì", "Áä¨„ÅØ", "‰∏ñÁïå„ÅØ"] },
      { label: "G2 ÂΩ¢ÂÆπ", color: "#FF9900",
        words: ["ÊúÄÈ´ò„ÅÆ", "ÊúÄÂº∑„ÅÆ", "‰ºùË™¨„ÅÆ", "„Ç¢„Éõ„ÅÆ", "Â§öÊï∞„ÅÆ", "ÂÖâ„ÅÆ", "Á∑ë„ÅÆ", "Ë°ó„ÅÆ", "„Åì„Åì„ÅÆ"] },
      { label: "G3 ÂêçË©û", color: "#00E5FF",
        words: ["„É©„ÉÉ„Éë„Éº", "Â§©Êâç", "Áõ∏Ê£í", "Áä¨", "„É¨„Ç∏„Çß„É≥„Éâ", "„Å´„Çè„Å®„Çä", "Áï™‰∫∫", "Ë®º‰∫∫", "Â±±Áî∞"] },
      { label: "G4 ÂãïË©û", color: "#B2FF59",
        words: ["‰ªä„Åô„Åê", "„Åì„Åì„Åß", "„Éê„Ç§„Éñ„Çπ", "Ë∏ä„Çã", "È©ö„Åè", "Âõû„Çã", "ÂÜ∑„Åü„ÅÑ", "„Ç¢„Éõ„Åª„Å©"] },
      { label: "G5 Á∑†„ÇÅ", color: "#EA80FC",
        words: ["Âè´„Å∂„ÅúÔºÅ", "Ê±∫„ÇÅ„Çã„ÅúÔºÅ", "„Ç§„Çß„Ç¢ÔºÅ", "Ë∏ä„Çã„ÅúÔºÅ", "„ÅÆ„Åº„Çã„ÅúÔºÅ", "„Éò„Ç§ÔºÅ", "„Åç„ÇÅ„ÇçÔºÅ", "„Åæ„Åã„Åõ„ÇçÔºÅ", "„Åï„Åõ„Å¶È†Ç„Åç„Åæ„Åô"] }
    ];

    /* ============================================
       „Éì„Éº„ÉàÈü≥Ê∫ê„Éû„ÉÉ„Éî„É≥„Ç∞
       ‚Äª index.html „Å®Âêå„Åò„Éï„Ç©„É´„ÉÄ„Å´ÁΩÆ„ÅÑ„Å¶„Åè„Å†„Åï„ÅÑ
       ‚Äª ‰ªñ„ÅÆ„Éì„Éº„Éà„ÅåÁî®ÊÑè„Åß„Åç„Åü„Çâ‰æã„ÅÆ„Çà„ÅÜ„Å´ËøΩÂä†OK
          ‰æã) 1: "beat2.wav"
    ============================================ */
    var beatAudioMap = {
      0: "beat1.wav",   // üî• TRAP
      1: "beat2.wav"    // üí• BOOM BAP
    };

    /* ============================================
       ÂçòË™ûÈü≥Â£∞„Éû„ÉÉ„Éî„É≥„Ç∞
       ‚Äª index.html „Å®Âêå„Åò„Éï„Ç©„É´„ÉÄ„Å´ÁΩÆ„ÅÑ„Å¶„Åè„Å†„Åï„ÅÑ
    ============================================ */
    var wordAudioMap = {
      "‰ø∫„ÅØ":     "1-1_oreha.wav",
      "ÊúÄÈ´ò„ÅÆ":   "2-1_saiko-no.wav",
      "„É©„ÉÉ„Éë„Éº": "3-1_Rappa-.wav",
      "Â±±Áî∞":     "3-9_yamada.wav"
    };

    /* ============================================
       Áä∂ÊÖãÂ§âÊï∞Ôºà„Éö„Éº„Ç∏ÂÜÖ„Åß1Âõû„Å†„ÅëÂÆ£Ë®ÄÔºâ
    ============================================ */
    var beatAudio      = null;  // „É´„Éº„Éó‰∏≠„ÅÆ„Éì„Éº„Éà Audio
    var beatPlayingIdx = null;  // ÂÜçÁîü‰∏≠„Éì„Éº„Éà„ÅÆÁï™Âè∑
    var lyricHistory   = [];    // „É©„Ç§„É†„ÉÜ„Éº„ÉóÂ±•Ê≠¥

    /* ============================================
       „Éì„Éº„Éà ÂÅúÊ≠¢ / ÂÜçÁîü
    ============================================ */
    function stopBeat() {
      if (beatAudio) {
        beatAudio.pause();
        beatAudio.currentTime = 0;
        beatAudio = null;
      }
      beatPlayingIdx = null;
      document.querySelectorAll(".beat-btn").forEach(function(b) {
        b.classList.remove("active");
      });
    }

    function startBeat(index, btn) {
      var file = beatAudioMap[index];
      if (file) {
        beatAudio = new Audio(file);
        beatAudio.loop = true;  // „É´„Éº„ÉóÂÜçÁîü
        beatAudio.play().catch(function(e) {
          console.warn("„Éì„Éº„ÉàÂÜçÁîü„Ç®„É©„Éº:", e);
        });
      }
      beatPlayingIdx = index;
      btn.classList.add("active");
    }

    /* ============================================
       ÂçòË™ûÈü≥Â£∞ ÂÜçÁîüÔºà„Éì„Éº„Éà„Å´Èáç„Å≠„Å¶È≥¥„Çâ„ÅôÔºâ
    ============================================ */
    function playWordAudio(word) {
      var file = wordAudioMap[word];
      if (file) {
        // new Audio() „ÅßÊØéÂõûÊñ∞„Åó„ÅÑ„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„ÇíÁîüÊàê„Åô„Çã„ÅÆ„Åß
        // „Éì„Éº„Éà„Å®Âà•„ÉÅ„É£„É≥„Éç„É´„ÅßÈáç„Å™„Å£„Å¶ÂÜçÁîü„Åï„Çå„Çã
        var audio = new Audio(file);
        audio.play().catch(function(e) {
          console.warn("ÂçòË™ûÈü≥Â£∞„Ç®„É©„Éº:", e);
        });
      }
    }

    /* ============================================
       „Éì„Éº„Éà„Éú„Çø„É≥„ÅÆÁîüÊàê
    ============================================ */
    var beatRow = document.getElementById("beat-row");
    beats.forEach(function(label, i) {
      var btn = document.createElement("button");
      btn.className = "beat-btn";
      btn.textContent = label;
      btn.addEventListener("click", function() {
        if (beatPlayingIdx === i) {
          stopBeat();          // Âêå„Åò„Éú„Çø„É≥ ‚Üí ÂÅúÊ≠¢
        } else {
          stopBeat();          // ‰ªñ„ÅÆ„Éì„Éº„Éà„ÇíÊ≠¢„ÇÅ„Å¶„Åã„Çâ
          startBeat(i, btn);   // Êñ∞„Åó„ÅÑ„Éì„Éº„Éà„ÇíÂÜçÁîü
        }
      });
      beatRow.appendChild(btn);
    });

    /* ============================================
       ÂçòË™û„Ç∞„É´„Éº„Éó„ÅÆÁîüÊàê
    ============================================ */
    var groupsArea = document.getElementById("groups-area");
    groups.forEach(function(g) {
      var groupDiv = document.createElement("div");
      groupDiv.className = "group";

      var wordGrid = document.createElement("div");
      wordGrid.className = "word-grid";

      g.words.forEach(function(word) {
        var btn = document.createElement("button");
        btn.className = "word-btn";
        btn.textContent = word;
        btn.style.color = g.color;
        btn.style.border = "1.5px solid " + g.color + "55";
        btn.style.background = g.color + "11";

        btn.addEventListener("mouseenter", function() {
          btn.style.background = g.color + "33";
          btn.style.boxShadow = "0 0 16px " + g.color + "66";
        });
        btn.addEventListener("mouseleave", function() {
          btn.style.background = g.color + "11";
          btn.style.boxShadow = "none";
        });
        btn.addEventListener("click", function() {
          handleWord(word, g.color);
        });

        wordGrid.appendChild(btn);
      });

      groupDiv.appendChild(wordGrid);
      groupsArea.appendChild(groupDiv);
    });

    /* ============================================
       ÂçòË™û„Éú„Çø„É≥Êäº‰∏ãÂá¶ÁêÜ
    ============================================ */
    function handleWord(word, color) {
      playWordAudio(word);

      document.getElementById("display-area").style.borderColor = color + "88";
      document.getElementById("placeholder").style.display = "none";

      var bigWord = document.getElementById("big-word");
      bigWord.style.color = color;
      bigWord.style.display = "";  // „Ç§„É≥„É©„Ç§„É≥style„Çí„É™„Çª„ÉÉ„Éà„Åó„Å¶CSS„Å´Êàª„Åô
      bigWord.textContent = word;
      bigWord.classList.remove("pop");
      void bigWord.offsetWidth; // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„É™„Çª„ÉÉ„ÉàÁî®
      bigWord.classList.add("pop");

      lyricHistory.push({ word: word, color: color });
      if (lyricHistory.length > 7) lyricHistory.shift();
      renderLyricTape();
    }

    /* ============================================
       „É©„Ç§„É†„ÉÜ„Éº„ÉóÊèèÁîª
    ============================================ */
    function renderLyricTape() {
      var tape = document.getElementById("lyric-tape");
      tape.innerHTML = "";
      lyricHistory.forEach(function(item) {
        var chip = document.createElement("span");
        chip.className = "lyric-chip";
        chip.textContent = item.word;
        chip.style.color = item.color;
        chip.style.borderColor = item.color + "55";
        tape.appendChild(chip);
      });
      document.getElementById("clear-btn").style.display =
        lyricHistory.length > 0 ? "block" : "none";
    }

    /* ============================================
       „ÇØ„É™„Ç¢„Éú„Çø„É≥
    ============================================ */
    function clearLyric() {
      lyricHistory = [];
      renderLyricTape();
      var bigWord = document.getElementById("big-word");
      bigWord.classList.remove("pop");
      bigWord.style.display = "none";
      document.getElementById("placeholder").style.display = "block";
      document.getElementById("display-area").style.borderColor = "#333";
    }

  </script>
</body>
</html>
