<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>ğŸ¤ RAP BOARD</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@700;900&family=Bebas+Neue&display=swap" rel="stylesheet" />
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    html, body {
      height: 100%;
      width: 100%;
      overflow: hidden;
    }

    body {
      background: #0a0a0f;
      font-family: 'Noto Sans JP', sans-serif;
      color: #fff;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background-image:
        linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px);
      background-size: 40px 40px;
      pointer-events: none;
      z-index: 0;
    }

    /* â”€â”€ ãƒ˜ãƒƒãƒ€ãƒ¼ â”€â”€ */
    #header {
      position: relative;
      z-index: 1;
      height: 48px;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #logo {
      font-family: 'Bebas Neue', cursive;
      font-size: 1.8rem;
      letter-spacing: 0.12em;
      background: linear-gradient(90deg, #FF3366, #FF9900, #00E5FF);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    /* â”€â”€ ãƒ“ãƒ¼ãƒˆãƒœã‚¿ãƒ³ â”€â”€ */
    #beat-row {
      position: relative;
      z-index: 1;
      height: 52px;
      flex-shrink: 0;
      display: flex;
      gap: 10px;
      align-items: center;
      justify-content: center;
      padding: 0 12px;
    }
    .beat-btn {
      font-family: 'Bebas Neue', cursive;
      font-size: 1rem;
      letter-spacing: 0.1em;
      padding: 0 28px;
      height: 40px;
      border-radius: 6px;
      cursor: pointer;
      border: 2px solid rgba(255,255,255,0.15);
      background: rgba(255,255,255,0.05);
      color: #aaa;
      transition: all 0.2s ease;
      touch-action: manipulation;
    }
    .beat-btn.active {
      background: linear-gradient(135deg, #FF3366, #FF9900);
      border-color: #FF9900;
      color: #fff;
      box-shadow: 0 0 20px #FF990088;
    }

    /* â”€â”€ è¡¨ç¤ºã‚¨ãƒªã‚¢ â”€â”€ */
    #display-area {
      position: relative;
      z-index: 1;
      height: 96px;
      flex-shrink: 0;
      margin: 0 10px 6px;
      border: 1.5px solid #333;
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 6px 10px;
      background: rgba(255,255,255,0.02);
      transition: border-color 0.3s;
      overflow: hidden;
    }
    #display-top {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      width: 100%;
    }
    #big-word {
      font-family: 'Bebas Neue', cursive;
      font-size: clamp(2rem, 12vw, 3.5rem);
      letter-spacing: 0.05em;
      line-height: 1;
      text-shadow: 0 0 30px currentColor;
      display: none;
      text-align: center;
    }
    #big-word.pop {
      display: block;
      animation: popIn 0.35s cubic-bezier(.36,2,.6,1) forwards;
    }
    #placeholder {
      color: #333;
      font-size: 0.8rem;
      letter-spacing: 0.1em;
    }
    #clear-btn {
      font-size: 0.65rem;
      background: transparent;
      border: 1px solid #444;
      color: #555;
      border-radius: 4px;
      padding: 5px 10px;
      cursor: pointer;
      touch-action: manipulation;
      white-space: nowrap;
      display: none;
      flex-shrink: 0;
    }
    #lyric-tape {
      display: flex;
      flex-wrap: nowrap;
      gap: 5px;
      overflow: hidden;
      max-width: 100%;
      height: 22px;
    }
    .lyric-chip {
      font-size: 0.65rem;
      border: 1px solid;
      border-radius: 3px;
      padding: 2px 6px;
      font-weight: 700;
      white-space: nowrap;
      flex-shrink: 0;
    }

    /* â”€â”€ ãƒ¡ã‚¤ãƒ³ã‚¨ãƒªã‚¢ â”€â”€ */
    #main-area {
      position: relative;
      z-index: 1;
      flex: 1;
      min-height: 0;
      display: flex;
      gap: 8px;
      padding: 0 10px 10px;
      overflow: hidden;
    }

    /* å·¦ï¼šã‚°ãƒ«ãƒ¼ãƒ—é¸æŠ */
    #group-selector {
      width: 44px;
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .group-tab {
      flex: 1;
      min-height: 0;
      border-radius: 8px;
      cursor: pointer;
      border: 2px solid transparent;
      background: rgba(255,255,255,0.04);
      transition: all 0.15s ease;
      touch-action: manipulation;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .group-tab.active {
      background: rgba(255,255,255,0.12);
    }
    .group-tab-dot {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    /* å³ï¼šå˜èªã‚°ãƒªãƒƒãƒ‰ */
    #word-area {
      flex: 1;
      min-width: 0;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 6px;
      overflow: hidden;
    }
    .word-btn {
      font-family: 'Noto Sans JP', sans-serif;
      font-weight: 700;
      font-size: clamp(0.75rem, 3.5vw, 0.95rem);
      border-radius: 8px;
      cursor: pointer;
      border: none;
      transition: background 0.1s, transform 0.1s;
      touch-action: manipulation;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      padding: 0 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 0;
    }
    .word-btn:active { transform: scale(0.93); }

    @keyframes popIn {
      0%   { transform: scale(0.5) rotate(-5deg); opacity: 0; }
      60%  { transform: scale(1.15) rotate(2deg); opacity: 1; }
      100% { transform: scale(1) rotate(0deg);   opacity: 1; }
    }
  </style>
</head>
<body>

  <div id="header"><span id="logo">ğŸ¤ RAP BOARD</span></div>

  <div id="beat-row"></div>

  <div id="display-area">
    <div id="display-top">
      <div id="placeholder">â†“ å˜èªã‚’æŠ¼ã—ã¦ãƒ©ãƒƒãƒ—ã—ã‚ â†“</div>
      <div id="big-word"></div>
      <button id="clear-btn" onclick="clearLyric()">ã‚¯ãƒªã‚¢</button>
    </div>
    <div id="lyric-tape"></div>
  </div>

  <div id="main-area">
    <div id="group-selector"></div>
    <div id="word-area"></div>
  </div>

  <script>

    /* â”€â”€ ãƒ‡ãƒ¼ã‚¿ â”€â”€ */
    var beats = ["ğŸ”¥ TRAP", "ğŸ’¥ BOOM BAP"];

    var groups = [
      { color: "#FF3366",
        words: ["ä¿ºã¯", "ä¿ºã®", "ã“ã„ã¤ã¯", "ä¿ºã‚‰ã¯", "ãŠã¾ãˆ", "å…ˆç”Ÿ", "æ¯ã¡ã‚ƒã‚“", "çŠ¬ã¯", "ä¸–ç•Œã¯"] },
      { color: "#FF9900",
        words: ["æœ€é«˜ã®", "æœ€å¼·ã®", "ä¼èª¬ã®", "ã‚¢ãƒ›ã®", "å¤šæ•°ã®", "å…‰ã®", "ç·‘ã®", "è¡—ã®", "ã“ã“ã®"] },
      { color: "#00E5FF",
        words: ["ãƒ©ãƒƒãƒ‘ãƒ¼", "å¤©æ‰", "ç›¸æ£’", "çŠ¬", "ãƒ¬ã‚¸ã‚§ãƒ³ãƒ‰", "ã«ã‚ã¨ã‚Š", "ç•ªäºº", "è¨¼äºº", "å±±ç”°"] },
      { color: "#B2FF59",
        words: ["ä»Šã™ã", "ã“ã“ã§", "ãƒã‚¤ãƒ–ã‚¹", "è¸Šã‚‹", "é©šã", "å›ã‚‹", "å†·ãŸã„", "ã‚¢ãƒ›ã»ã©"] },
      { color: "#EA80FC",
        words: ["å«ã¶ãœï¼", "æ±ºã‚ã‚‹ãœï¼", "ã‚¤ã‚§ã‚¢ï¼", "è¸Šã‚‹ãœï¼", "ã®ã¼ã‚‹ãœï¼", "ãƒ˜ã‚¤ï¼", "ãã‚ã‚ï¼", "ã¾ã‹ã›ã‚ï¼", "ã•ã›ã¦é ‚ãã¾ã™"] }
    ];

    /* â”€â”€ éŸ³æºãƒãƒƒãƒ”ãƒ³ã‚°ï¼ˆindex.html ã¨åŒã˜ãƒ•ã‚©ãƒ«ãƒ€ã«é…ç½®ï¼‰ â”€â”€ */
    var beatAudioMap = {
      0: "beat1.wav",
      1: "beat2.wav"
    };
    var wordAudioMap = {
      "ä¿ºã¯":           "1-1_oreha.wav",
      "æœ€é«˜ã®":         "2-1_saiko-no.wav",
      "ãƒ©ãƒƒãƒ‘ãƒ¼":       "3-1_Rappa-.wav",
      "ç•ªäºº":           "3-7_bannin.wav",
      "è¨¼äºº":           "3-9_Shonin.wav",
      "å±±ç”°":           "3-9_yamada.wav",
      "ä»Šã™ã":         "4-1_imasugu.wav",
      "ã“ã“ã§":         "4-2_kokode.wav",
      "ãƒã‚¤ãƒ–ã‚¹":       "4-3_Bybs.wav",
      "è¸Šã‚‹":           "4-4_Odoru.wav",
      "é©šã":           "4-5_Odoroku.wav",
      "å›ã‚‹":           "4-6_Mawaru.wav",
      "å†·ãŸã„":         "4-7_Tsumetai.wav",
      "ã‚¢ãƒ›ã»ã©":       "4-8_Ahohodo.wav",
      "å«ã¶ãœï¼":       "5-1_Sakebuze.wav",
      "æ±ºã‚ã‚‹ãœï¼":     "5-2_Kimeruze.wav",
      "ã‚¤ã‚§ã‚¢ï¼":       "5-3_Yeah.wav",
      "è¸Šã‚‹ãœï¼":       "5-4_Odoruze.wav",
      "ã®ã¼ã‚‹ãœï¼":     "5-5_Noboruze.wav",
      "ãƒ˜ã‚¤ï¼":         "5-6_Hey.wav",
      "ãã‚ã‚ï¼":       "5-7_Kimero.wav",
      "ã¾ã‹ã›ã‚ï¼":     "5-8_makasero.wav",
      "ã•ã›ã¦é ‚ãã¾ã™": "5-9_Saseteitadakimas.wav"
      // G1ãƒ»G2ã®æ®‹ã‚Šã¯wavã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¾Œã«è¿½åŠ 
    };

    /* â”€â”€ çŠ¶æ…‹ â”€â”€ */
    var beatAudio      = null;
    var beatPlayingIdx = null;
    var lyricHistory   = [];
    var activeGroupIdx = 0;

    /* â”€â”€ éŸ³å£°ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆè§£é™¤ï¼ˆiOSãªã©ã®è‡ªå‹•å†ç”Ÿãƒ–ãƒ­ãƒƒã‚¯å¯¾ç­–ï¼‰ â”€â”€ */
    var audioUnlocked = false;
    function unlockAudio() {
      if (audioUnlocked) return;
      var dummy = new Audio();
      dummy.play().catch(function() {});
      audioUnlocked = true;
    }
    document.addEventListener("touchstart", unlockAudio, { once: true });
    document.addEventListener("click", unlockAudio, { once: true });

    /* â”€â”€ ãƒ“ãƒ¼ãƒˆæ“ä½œ â”€â”€ */
    function stopBeat() {
      if (beatAudio) {
        beatAudio.loop = false;      // ãƒ«ãƒ¼ãƒ—ã‚’æ­¢ã‚ã¦ã‹ã‚‰
        beatAudio.pause();
        beatAudio.currentTime = 0;
        beatAudio = null;
      }
      beatPlayingIdx = null;
      document.querySelectorAll(".beat-btn").forEach(function(b) { b.classList.remove("active"); });
    }

    function startBeat(idx, btn) {
      var file = beatAudioMap[idx];
      if (!file) { beatPlayingIdx = idx; btn.classList.add("active"); return; }
      beatAudio = new Audio(file);
      beatAudio.loop = true;
      beatAudio.play().catch(function(e) {
        if (e.name !== "AbortError") {
          console.warn("beat error:", file, e.message);
        }
      });
      beatPlayingIdx = idx;
      btn.classList.add("active");
    }

    /* â”€â”€ å˜èªéŸ³å£°ï¼ˆãƒ“ãƒ¼ãƒˆã«é‡ã­ã¦å†ç”Ÿï¼‰ â”€â”€ */
    function playWordAudio(word) {
      var file = wordAudioMap[word];
      if (!file) return;
      var a = new Audio(file);
      a.play().catch(function(e) {
        console.warn("word error:", file, e.message);
      });
    }

    /* â”€â”€ ãƒ“ãƒ¼ãƒˆãƒœã‚¿ãƒ³ç”Ÿæˆ â”€â”€ */
    beats.forEach(function(label, i) {
      var btn = document.createElement("button");
      btn.className = "beat-btn";
      btn.textContent = label;
      btn.addEventListener("click", function() {
        if (beatPlayingIdx === i) { stopBeat(); } else { stopBeat(); startBeat(i, btn); }
      });
      document.getElementById("beat-row").appendChild(btn);
    });

    /* â”€â”€ ã‚°ãƒ«ãƒ¼ãƒ—ã‚¿ãƒ–ç”Ÿæˆ â”€â”€ */
    groups.forEach(function(g, i) {
      var tab = document.createElement("button");
      tab.className = "group-tab" + (i === 0 ? " active" : "");
      tab.style.borderColor = i === 0 ? g.color : "transparent";

      var dot = document.createElement("div");
      dot.className = "group-tab-dot";
      dot.style.background = g.color;
      tab.appendChild(dot);

      tab.addEventListener("click", function() {
        activeGroupIdx = i;
        document.querySelectorAll(".group-tab").forEach(function(t, j) {
          t.classList.toggle("active", j === i);
          t.style.borderColor = j === i ? groups[j].color : "transparent";
        });
        renderWordArea();
      });

      document.getElementById("group-selector").appendChild(tab);
    });

    /* â”€â”€ å˜èªã‚¨ãƒªã‚¢æç”» â”€â”€ */
    function renderWordArea() {
      var wordArea = document.getElementById("word-area");
      wordArea.innerHTML = "";
      var g = groups[activeGroupIdx];
      var rows = Math.ceil(g.words.length / 2);
      wordArea.style.gridTemplateRows = "repeat(" + rows + ", 1fr)";

      g.words.forEach(function(word) {
        var btn = document.createElement("button");
        btn.className = "word-btn";
        btn.textContent = word;
        btn.style.color = g.color;
        btn.style.background = g.color + "18";
        btn.style.border = "1.5px solid " + g.color + "55";
        btn.addEventListener("click", function() { handleWord(word, g.color); });
        wordArea.appendChild(btn);
      });
    }

    /* â”€â”€ å˜èªæŠ¼ä¸‹ â”€â”€ */
    function handleWord(word, color) {
      playWordAudio(word);
      document.getElementById("display-area").style.borderColor = color + "88";
      document.getElementById("placeholder").style.display = "none";

      var bw = document.getElementById("big-word");
      bw.style.color = color;
      bw.style.display = "";
      bw.textContent = word;
      bw.classList.remove("pop");
      void bw.offsetWidth;
      bw.classList.add("pop");

      lyricHistory.push({ word: word, color: color });
      if (lyricHistory.length > 8) lyricHistory.shift();
      renderLyricTape();
    }

    /* â”€â”€ ãƒ©ã‚¤ãƒ ãƒ†ãƒ¼ãƒ— â”€â”€ */
    function renderLyricTape() {
      var tape = document.getElementById("lyric-tape");
      tape.innerHTML = "";
      lyricHistory.forEach(function(item) {
        var chip = document.createElement("span");
        chip.className = "lyric-chip";
        chip.textContent = item.word;
        chip.style.color = item.color;
        chip.style.borderColor = item.color + "55";
        tape.appendChild(chip);
      });
      document.getElementById("clear-btn").style.display =
        lyricHistory.length > 0 ? "block" : "none";
    }

    /* â”€â”€ ã‚¯ãƒªã‚¢ â”€â”€ */
    function clearLyric() {
      lyricHistory = [];
      renderLyricTape();
      var bw = document.getElementById("big-word");
      bw.classList.remove("pop");
      bw.style.display = "none";
      document.getElementById("placeholder").style.display = "block";
      document.getElementById("display-area").style.borderColor = "#333";
      document.getElementById("clear-btn").style.display = "none";
    }

    /* â”€â”€ åˆæœŸæç”» â”€â”€ */
    renderWordArea();

  </script>
</body>
</html>
